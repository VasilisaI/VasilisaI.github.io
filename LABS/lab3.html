<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lab 2</title>
  
  <link rel="stylesheet" href="/LABS/style.css">
  <style>
    body {
      background-color: #a897d0;
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 20px;
    }

    .wrapper {
      background: #ffffff;
      max-width: 1000px;
      margin: 0 auto;
      padding: 40px;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    .video-center {
      display: flex;
      justify-content: center;
      margin-bottom: 25px;
    }

    .img-grid {
      display: flex; 
      gap: 10px; 
      margin-bottom: 20px;
      justify-content: center;
    }

    .img-grid img {
      width: 49%; 
      height: auto;
      border-radius: 4px;
    }

    .info-card {
      background: #f4f4f4;
      border-left: 5px solid #a897d0;
      padding: 15px;
      margin: 20px 0;
    }

    img, video {
      border-radius: 4px;
      display: block;
      margin: 0 auto 20px auto;
    }

    h1, h3, h4, h5 {
      color: #333;
    }
  </style>
</head>

<body>
<div class="wrapper">

  <h1>Lab 3: Time of Flight Sensor</h1>

  <section>
    <h2>Pre Lab</h2>
    <img src="/assets/media3/setup.png" alt="IMU Connection" style="width: 40%;">

   <div style="display: flex; justify-content: space-around; align-items: flex-start; gap: 20px;">
  
  <div style="text-align: center;">
    <h3>Schematic</h3>
    <img src="/assets/media3/Schematic.drawio.png" alt="Schematic" style="width: 100%; max-width: 400px;">
  </div>

</div>

<div class="container">
  <h3>Sensor Placement</h3>
  <div class="info-card">
    <p>
      Both sensors will be placed at the front of the car, each slightly angled to 
      face either the left or right side. Placing both ToFs at the front expands the car's field of view. However, 
      the car may miss side obstacles if they are not initially visible from the front, for example dynamic obstacles approaching from the side. 
    </p>
  </div>
  <img src="/assets/media3/car.png" alt="RC Car Sensor Placement" class="sensor-image">
</div>

<div class="info-card">
 <h3>Two-Sensor Setup</h3>
<p>
  To use two ToF sensors, I will use the xshut pins ( pins 7 and 8 on the MCU) to change the address of one sensor from 0x29 to 0x30 while it is powered. 
  The sensor configuration code is shown below. 
</p>
</div>
   
<details>
<summary>Configuration</summary>
<div style="display: flex; align-items: flex-start; padding-top: 15px;">
  <div style="flex: 1; padding-right: 20px;">
    <h4 style="margin: 0 0 10px 0;">Artemis Code</h4>
    <script src="https://gist.github.com/VasilisaI/e9aee7171846df15a89101f028e012b8.js"></script>
  </div>
</div>
</details>

<h3>Two Sensors Working</h3>
<div class="video-center">
  <video controls width="80%">
    <source src="/assets/media3/IMG_6446.MOV" type="video/mp4">
  </video>
</div>

<h4>I2C Address</h4>
<img src="/assets/media3/address_i2c.png" alt="I2C Address" style="width: 80%;">
<div class="info-card">
  <p>
    The displayed I2C address is 0x29, which matches the expected value because 0x29 is 
    0010 1001 in binary. An I2C address consists of bits 1-7 representing the unique address 
    of the slave device, and a Read/Write bit at bit 0. 
    The last bit being 1 indicates that we are reading from the ToF sensor, which is expected.
  </p>
</div>

<h4>Mode Selection</h4>
<div class="info-card">
  <p>
    Using the short distance mode increases immunity to ambient light and noise. However, it limits the detection range. 
    The long mode allows detecting objects up to 4 m but is more susceptible to noise. 
    The medium mode is a compromise between the two. For the RC car, the short range is sufficient since 1.3 meters is enough for the car
    to react to obstacles, and the higher noise immunity improves performance.
  </p>
</div>
    
<h4>Sensor Characterization</h4>

<div class="info-card">
  <p>
    The sensor was tested in rooms with high artificial light, low artificial light, and a mix of natural and artificial light. 
   Errors start increasing linearly at about 60 cm and rise drastically near the maximum range of 130 cm. 
   The precision graph shows the sensor is accurate except in dark environments. 
</div>


<h4>Expected vs Measured Results</h4>
<img src="/assets/media3/expected_vs_measured.png" alt="Expected vs Measured Results" style="width: 60%;">
<h4>Accuracy</h4>
<img src="/assets/media3/Accuracy.png" alt="Accuracy" style="width: 60%;">
<h4>Precision</h4>
<img src="/assets/media3/precision.png" alt="Precision" style="width: 60%;">

<h4>Ranging Time</h4>
<div class="info-card">
  <p>
    The average of 10 readings shows a ranging time of approximately 97.6 ms. Ranging time did not increase with different modes. 
  </p>
</div>

<details>
<summary>Fast Code</summary>
<div style="display: flex; align-items: flex-start; padding-top: 15px;">
  <div style="flex: 1; padding-right: 20px;">
    <h4 style="margin: 0 0 10px 0;">Artemis Code</h4>
    <script src="https://gist.github.com/VasilisaI/6795c22a29cc600dbc0bf5de4dfa209a.js"></script>
  </div>
</div>
</details>
     
<div class="info-card">
  <p>
   
    In the sped up code, the time between consecutive readings of A and B ToF sensor svaries between 10–25 ms, and consecutive A and B readings vary between 100–200 ms. 
    The limiting factors in the transmission speed include Serial print delays and the intrinsic time required to collect and validate data. 
  </p>
</div>

<h3>Color Impact</h3>
<img src="/assets/media3/colors.png" alt="Flat" style="width: 80%;">
<img src="/assets/media3/color.png" alt="Flat" style="width: 100%;">
<div class="info-card">
  <p>
    The color tests show that darker materials appear closer due to light absorption. Very light materials, like white, may over-report distances slightly due to placement discrepancies during measurement.
  </p>
</div>

<h4>Texture Impact</h4>
<img src="/assets/media3/texture.png" alt="Flat" style="width: 80%;">
<img src="/assets/media3/material.png" alt="Flat" style="width: 100%;">
<div class="info-card">
  <p>
    Texture did not significantly affect measurements. Velvet overestimated distance by almost 2 cm, but other materials had minimal impact on light scattering.
  </p>
</div>

<h4>Bluetooth</h4>
<img src="/assets/media3/angle_v_time.png" alt="Flat" style="width: 100%;">
<img src="/assets/media3/distance_v_time.png" alt="Flat" style="width: 100%;">

<h3>Distance Sensors</h3>
<div class="info-card">
  <p>
    Besides Time of Flight sensors, there are Amplitude-based IR sensors and IR triangulation. Amplitude-based IR has a high sampling rate and small size but is sensitive to ambient light. 
    IR triangulation is less sensitive to surface color/texture but has a larger form factor and lower sampling rate.
  </p>
</div>

<h3>Resources</h3>
<p>
  Class notes were used for information on IR distance sensors, and Gemini was used to process ToF sensor characterization data.
</p>

</section>
</div>
</body>
</html>